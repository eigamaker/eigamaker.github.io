# Profilecode診断システム - 実装仕様書

**作成日**: 2025年1月  
**最終更新**: 2025年1月  
**目的**: 仕様、現状の実装状況、改善計画を統合した包括的なドキュメント

---

## 📋 目次

1. [システム概要](#システム概要)
2. [仕様定義](#仕様定義)
3. [現状の実装状況](#現状の実装状況)
4. [改善計画](#改善計画)
5. [技術仕様](#技術仕様)
6. [データ構造](#データ構造)

---

## 🎯 システム概要

### プロジェクトの目的

Profilecode診断システムは、ウェブとアプリで一貫した体験を提供する性格診断サービスです。

### 主要機能

1. **統一質問セットによる診断**: 1回の質問回答で複数の診断結果を同時に計算
2. **4つの診断タイプ**: Profilecode（独自）、MBTI、16PF、DISC
3. **多言語対応**: 13言語に対応
4. **Supabase連携**: ログイン済みユーザーのデータ同期

---

## 📐 仕様定義

### 1. 質問の出題仕様

#### ✅ 確定仕様

**質問数**: 
- **40問**（question_id: 1～40）
- スターター質問として固定

**出題順序**:
- **固定順序**: question_id 1から始まり、40で終わる
- ランダム出題は**行わない**
- 順番通りに1問ずつ表示

**出題方法**:
```javascript
// 仕様: 固定順序で出題
questions = [question1, question2, question3, ..., question40]
// 順番通りに表示
```

#### 質問データの構造

```javascript
{
  id: 1,  // question_id: 1～40
  question: "質問文（多言語対応）",
  options: [
    { text: "強く同意", value: 2 },
    { text: "同意", value: 1 },
    { text: "どちらでもない", value: 0 },
    { text: "反対", value: -1 },
    { text: "強く反対", value: -2 }
  ],
  mappings: {
    profilecode: { /* マッピング */ },
    fourIndicator: { /* マッピング */ },
    sixteenFactor: { /* マッピング */ },
    disc: { /* マッピング */ }
  }
}
```

---

### 2. 多言語化仕様

#### 対応言語（13言語）

1. **アラビア語** (ar)
2. **ドイツ語** (de)
3. **英語** (en)
4. **スペイン語** (es)
5. **フランス語** (fr)
6. **ヒンディー語** (hi)
7. **インドネシア語** (id)
8. **イタリア語** (it)
9. **日本語** (ja)
10. **韓国語** (ko)
11. **ポルトガル語** (pt)
12. **簡体中国語** (zh)
13. **繁体中国語** (zh_hant)

#### 多言語化の対象

1. **UIテキスト**: ボタン、ラベル、メッセージ
2. **質問テキスト**: 40問すべての質問文
3. **選択肢テキスト**: 5つの選択肢（強く同意、同意、どちらでもない、反対、強く反対）
4. **診断結果**: タイプ名、説明文、アドバイス
5. **メタ情報**: ページタイトル、説明文

#### 言語切り替え機能

- ブラウザの言語設定から自動検出
- LocalStorageに言語設定を保存
- ページ上部に言語切り替えボタンを配置
- 言語変更時にページ全体を動的に更新

---

### 3. 診断タイプ仕様

#### 3.1 Profilecode診断（独自診断）

**5次元包括診断**:

1. **キャリア適性次元**
   - 8タイプ: 創造的イノベーター、分析的専門家、社会的貢献者、組織的マネージャー、独立起業家、安定実務者、成長挑戦者、バランス型
   - 適性職種、働き方、価値観を表示

2. **学習スタイル次元**
   - 6タイプ: 視覚的学習者、聴覚的学習者、実践的学習者、読書的学習者、体験的学習者、統合的学習者
   - 最適な学習方法、環境、コツを表示

3. **コミュニケーションスタイル次元**
   - 6タイプ: 直接的コミュニケーター、共感的リスナー、論理的説明者、社交的ネットワーカー、深い関係構築者、適応的コミュニケーター

4. **ストレス対処次元**
   - 5タイプ: 戦闘的対処者、適応的リカバリー型、休息重視型、社会的サポート型、無視回避型

5. **意思決定スタイル次元**
   - 5タイプ: データドリブン型、直感重視型、相談重視型、迅速決断型、慎重分析型

#### 3.2 MBTI診断（参考診断）

- **4指標**: E/I、S/N、T/F、J/P
- **16タイプ**: ENFP、ENFJ、ENTP、ENTJ、ESFP、ESFJ、ESTP、ESTJ、INFP、INFJ、INTP、INTJ、ISFP、ISFJ、ISTP、ISTJ
- **商標表記**: 「MBTI®はMyers-Briggs Type Indicator®の商標です。本サービスはMBTI®の公式サービスではありません。」

#### 3.3 16PF診断（参考診断）

- **16因子**: warmth、reasoning、emotional_stability、dominance、liveliness、rule_consciousness、social_boldness、sensitivity、vigilance、abstractedness、privateness、apprehension、openness_to_change、self_reliance、perfectionism、tension
- **スコア範囲**: 0-100点
- **商標表記**: 「16PF®は16 Personality Factor®の商標です。本サービスは16PF®の公式サービスではありません。」

#### 3.4 DISC診断（参考診断）

- **4スタイル**: D（主導性）、I（影響力）、S（安定性）、C（慎重性）
- **主要スタイル**: 最も高いスコアのスタイル
- **商標表記**: 「DISC®はDISC Assessment®の商標です。本サービスはDISC®の公式サービスではありません。」

---

### 4. スコア計算仕様

#### 計算方法

1. **重み付け計算**: 各質問に重み（weight）を設定
2. **スコア加算**: 回答値 × 重み × マッピング値
3. **正規化**: スコアを0-100の範囲に正規化
4. **タイプ判定**: スコアが最も高いタイプを判定

#### スコア表示仕様

**改善が必要な項目**:
- レーダーチャートやバーグラフの視覚化
- スコアの意味を明確に説明
- スコアの範囲（0-100）の解釈方法
- 高スコア/低スコアの意味

---

### 5. Supabase連携仕様

#### データ保存

**ログイン済みユーザー**:
- 診断完了時に自動的にSupabaseに保存
- `responses`テーブル: 回答データ
- `response_scores`テーブル: 診断スコア
- `user_question_history`テーブル: 質問履歴

**未ログインユーザー**:
- LocalStorageに保存
- メールアドレス登録時にSupabaseに移行

#### 質問履歴の同期

**現状**: 未実装（改善予定）

**将来の実装**:
- ログイン済みユーザーが診断開始時に`user_question_history`を取得
- 既に回答済みの質問を除外
- 未回答の質問から出題（固定順序で）

---

## 🔧 現状の実装状況

### 1. 質問の出題

#### ✅ 実装済み

- **質問数**: 40問（question_id: 1～40）
- **出題順序**: 固定順序（1→2→3...→40）
- **進捗表示**: 「質問 X / 40」と進捗バー
- **前へ/次へボタン**: 回答を修正可能
- **回答の保存**: LocalStorageに自動保存
- **回答の復元**: ページ再読み込み時に回答を復元

#### ⚠️ 未実装

- 質問履歴の同期機能（ログイン済みユーザー向け）

---

### 2. 多言語化

#### ✅ 実装済み

- **13言語対応**: アラビア語、ドイツ語、英語、スペイン語、フランス語、ヒンディー語、インドネシア語、イタリア語、日本語、韓国語、ポルトガル語、簡体中国語、繁体中国語
- **言語検出**: ブラウザの言語設定とLocalStorageから自動検出
- **言語切り替え**: ページ上部に言語切り替えボタンを配置
- **動的更新**: 言語変更時にページ全体を自動更新

#### ⚠️ 改善が必要

- **質問テキスト**: 一部の言語で翻訳が不完全な可能性
- **診断結果の詳細説明**: 一部の言語で説明が不足している可能性
- **言語切り替えUI**: モバイルデバイスで窮屈になる可能性

---

### 3. 診断タイプ

#### ✅ 実装済み

- **Profilecode診断**: 5次元包括診断（キャリア適性、学習スタイル、コミュニケーション、ストレス対処、意思決定）
- **MBTI診断**: 4指標診断、16タイプ判定
- **16PF診断**: 16因子診断、スコア表示
- **DISC診断**: 4スタイル診断、主要スタイル判定

#### ⚠️ 改善が必要

- **診断結果の多言語化**: すべての言語で詳細説明を提供
- **スコア表示の視覚化**: レーダーチャートやバーグラフの改善

---

### 4. スコア計算

#### ✅ 実装済み

- **重み付け計算**: 各質問に重みを設定
- **正規化**: スコアを0-100の範囲に正規化
- **タイプ判定**: スコアが最も高いタイプを判定

#### ⚠️ 改善が必要

- **スコア表示の視覚化**: レーダーチャートやバーグラフをより視覚的に表示
- **スコアの解釈**: スコアの意味を明確に説明
- **スコアの比較**: 過去の診断結果との比較機能

---

### 5. Supabase連携

#### ✅ 実装済み

- **ログイン機能**: Supabase Authを使用
- **データ保存**: 診断完了時に自動保存
- **データ移行**: LocalStorageからSupabaseへの移行機能

#### ⚠️ 未実装

- **質問履歴の同期**: ログイン済みユーザーが既に回答済みの質問を除外する機能

---

## 🚀 改善計画

### 優先度: 高

#### 1. 多言語化の完全実装

**目標**: すべての言語で完全な翻訳を提供

**実装内容**:
- [ ] すべての言語で質問1～40の翻訳を確認・完成
- [ ] すべての言語で診断結果の詳細説明を提供
- [ ] MBTI、16PF、DISCのタイプ説明をすべての言語で実装
- [ ] 文化的な文脈を考慮した翻訳の見直し

**実装ファイル**:
- `js/translations.js`: UIテキスト、質問テキスト
- `js/result-translations.js`: 診断結果の詳細説明
- `js/result-details-en.js`: 英語の詳細説明（他言語も追加）

---

#### 2. スコア表示の改善

**目標**: スコアを視覚的に分かりやすく表示

**実装内容**:
- [ ] レーダーチャートの実装（16PF、DISC）
- [ ] バーグラフの改善（MBTI、Profilecode）
- [ ] スコアの色分け（高スコア=緑、低スコア=赤など）
- [ ] スコアの意味を説明するツールチップを追加
- [ ] スコアの範囲（0-100）の解釈方法を明確に表示

**実装ファイル**:
- `test.html`: 結果表示部分
- `js/calculators/*.js`: スコア計算ロジック

---

#### 3. 診断結果の多言語化

**目標**: すべての言語で診断結果の詳細説明を提供

**実装内容**:
- [ ] すべての言語でProfilecode診断のタイプ説明を提供
- [ ] すべての言語でMBTI診断のタイプ説明を提供
- [ ] すべての言語で16PF診断の因子説明を提供
- [ ] すべての言語でDISC診断のスタイル説明を提供

**実装ファイル**:
- `js/result-translations.js`: 診断結果の翻訳データ
- `js/result-details-*.js`: 各言語の詳細説明（新規作成）

---

### 優先度: 中

#### 4. 言語切り替えUIの改善

**目標**: モバイルデバイスでも使いやすいUI

**実装内容**:
- [ ] ドロップダウンメニューまたは折りたたみ可能なUI
- [ ] 現在の言語を明確に表示
- [ ] モバイルデバイスでの表示を最適化

**実装ファイル**:
- `index.html`: 言語切り替えUI
- `test.html`: 言語切り替えUI

---

#### 5. 質問履歴の同期機能（将来実装）

**目標**: ログイン済みユーザーが既に回答済みの質問を除外

**実装内容**:
- [ ] `js/question-history.js`を作成
- [ ] `getQuestionHistory()`関数を実装
- [ ] 診断開始時に質問履歴を取得
- [ ] 既に回答済みの質問を除外（固定順序で出題）

**注意**: 出題順序は固定（1→2→3...→40）のまま

---

### 優先度: 低

#### 6. 過去の診断結果との比較機能

**目標**: ユーザーが自分の変化を確認できる

**実装内容**:
- [ ] 過去の診断結果を取得
- [ ] スコアの推移をグラフで表示
- [ ] 診断結果の比較機能

---

## 💻 技術仕様

### 使用技術

- **HTML5**: セマンティックマークアップ
- **CSS3**: モダンなスタイリング、レスポンシブデザイン
- **JavaScript (Vanilla)**: フレームワークなし、軽量実装
- **LocalStorage**: 回答の一時保存
- **Supabase**: 認証、データ保存

### ファイル構成

```
profilecode.codes/
├── index.html                    # ランディングページ
├── test.html                     # 診断ページ
├── js/
│   ├── translations.js          # 翻訳データ（UI、質問）
│   ├── translations-id.js       # インドネシア語の追加翻訳
│   ├── translations-extra.js    # 追加翻訳
│   ├── result-translations.js  # 診断結果の翻訳
│   ├── result-translations-id.js # インドネシア語の診断結果
│   ├── result-details-en.js    # 英語の詳細説明
│   ├── result-details-id.js    # インドネシア語の詳細説明
│   ├── result-translations-fallback.js # フォールバック翻訳
│   ├── i18n.js                 # 国際化ユーティリティ
│   ├── questions.js             # 共有質問データ（40問）
│   ├── personality-test.js      # 診断メインロジック
│   ├── calculators/
│   │   ├── profilecode-calculator.js    # Profilecode診断計算
│   │   ├── four-indicator-calculator.js # MBTI診断計算
│   │   ├── sixteen-factor-calculator.js # 16PF診断計算
│   │   └── disc-calculator.js           # DISC診断計算
│   ├── supabase-config.js       # Supabase設定
│   ├── auth.js                  # 認証機能
│   ├── supabase-save.js         # データ保存
│   └── account-migration.js     # アカウント移行
```

---

## 📊 データ構造

### 質問データ

```javascript
{
  id: 1,  // question_id: 1～40
  question: "質問文（多言語対応）",
  options: [
    { text: "強く同意", value: 2 },
    { text: "同意", value: 1 },
    { text: "どちらでもない", value: 0 },
    { text: "反対", value: -1 },
    { text: "強く反対", value: -2 }
  ],
  mappings: {
    profilecode: {
      career: { dimension: 'work_style', weight: 0.8, value: 1 },
      learning: { dimension: 'learning_method', weight: 0.6, value: 1 },
      // ...
    },
    fourIndicator: {
      dimension: 'E/I',
      weight: 0.7,
      value: 1
    },
    sixteenFactor: {
      dimension: 'warmth',
      weight: 0.5,
      value: 1
    },
    disc: {
      dimension: 'I',
      weight: 0.7,
      value: 1
    }
  }
}
```

### 回答データ

```javascript
[
  { questionId: 1, value: 2 },
  { questionId: 2, value: -1 },
  // ...
]
```

### 診断結果データ

```javascript
{
  profilecode: {
    career: {
      type: 'creative_innovator',
      typeInfo: { /* タイプ情報 */ },
      scores: { /* スコア */ }
    },
    learning: { /* ... */ },
    communication: { /* ... */ },
    stress: { /* ... */ },
    decision: { /* ... */ }
  },
  mbti: {
    type: 'ENFP',
    scores: { E: 15, I: 5, S: 8, N: 12, T: 6, F: 14, J: 4, P: 16 },
    // ...
  },
  sixteenFactor: {
    factors: { warmth: 65, reasoning: 70, /* ... */ },
    // ...
  },
  disc: {
    primaryStyle: 'I',
    scores: { D: 45, I: 75, S: 60, C: 50 },
    // ...
  }
}
```

---

## ✅ 実装チェックリスト

### 多言語化の完全実装

- [ ] すべての言語で質問1～40の翻訳を確認・完成
- [ ] すべての言語で診断結果の詳細説明を提供
- [ ] MBTI、16PF、DISCのタイプ説明をすべての言語で実装
- [ ] 文化的な文脈を考慮した翻訳の見直し

### スコア表示の改善

- [ ] レーダーチャートの実装（16PF、DISC）
- [ ] バーグラフの改善（MBTI、Profilecode）
- [ ] スコアの色分け
- [ ] スコアの意味を説明するツールチップ
- [ ] スコアの範囲（0-100）の解釈方法を明確に表示

### 診断結果の多言語化

- [ ] すべての言語でProfilecode診断のタイプ説明を提供
- [ ] すべての言語でMBTI診断のタイプ説明を提供
- [ ] すべての言語で16PF診断の因子説明を提供
- [ ] すべての言語でDISC診断のスタイル説明を提供

### 言語切り替えUIの改善

- [ ] ドロップダウンメニューまたは折りたたみ可能なUI
- [ ] 現在の言語を明確に表示
- [ ] モバイルデバイスでの表示を最適化

---

## 📝 重要な注意事項

### 質問の出題順序

- **固定順序**: question_id 1から40まで順番通りに出題
- **ランダム出題は行わない**: 仕様として確定
- **質問履歴の同期**: 将来実装予定（既に回答済みの質問を除外）

### 多言語化

- **完全実装**: すべての言語で完全な翻訳を提供することを目標
- **文化的な文脈**: 翻訳時に文化的な文脈を考慮

### スコア表示

- **視覚化**: レーダーチャートやバーグラフで視覚的に表示
- **解釈**: スコアの意味を明確に説明

---

## 🔗 関連ドキュメント

- `personality_test_implementation_plan.md`: 実装プラン
- `profilecode_diagnosis_design.md`: Profilecode診断の設計
- `user_flow_explanation.md`: ユーザーフローの説明
- `web_implementation_improvements.md`: 改善提案
- `question_history_sync_implementation.md`: 質問履歴同期の実装計画
- `supabase-schema.md`: Supabaseスキーマ

---

**作成者**: AI Assistant  
**最終更新**: 2025年1月

