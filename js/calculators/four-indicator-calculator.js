// 4指標診断計算ロジック（参考診断）
// E/I, S/N, T/F, J/P の4指標を計算

class FourIndicatorCalculator {
  calculate(answers, questions) {
    const scores = {
      E: 0, I: 0,
      S: 0, N: 0,
      T: 0, F: 0,
      J: 0, P: 0
    };

    answers.forEach(answer => {
      const question = questions.find(q => q.id === answer.questionId);
      if (!question || !question.mappings || !question.mappings.fourIndicator) return;

      const mapping = question.mappings.fourIndicator;
      const value = answer.value * mapping.value;
      const weightedValue = value * mapping.weight;

      // 各指標にスコアを加算
      if (mapping.dimension === 'E/I') {
        if (value > 0) {
          scores.E += weightedValue;
        } else {
          scores.I += Math.abs(weightedValue);
        }
      } else if (mapping.dimension === 'S/N') {
        if (value > 0) {
          scores.S += weightedValue;
        } else {
          scores.N += Math.abs(weightedValue);
        }
      } else if (mapping.dimension === 'T/F') {
        if (value > 0) {
          scores.T += weightedValue;
        } else {
          scores.F += Math.abs(weightedValue);
        }
      } else if (mapping.dimension === 'J/P') {
        if (value > 0) {
          scores.J += weightedValue;
        } else {
          scores.P += Math.abs(weightedValue);
        }
      }
    });

    // タイプを判定
    const type = 
      (scores.E > scores.I ? 'E' : 'I') +
      (scores.S > scores.N ? 'S' : 'N') +
      (scores.T > scores.F ? 'T' : 'F') +
      (scores.J > scores.P ? 'J' : 'P');

    const typeNames = {
      'ENFP': 'キャンペーナー',
      'ENFJ': '教師',
      'ENTP': '討論者',
      'ENTJ': '指揮官',
      'ESFP': 'エンターテイナー',
      'ESFJ': '領事',
      'ESTP': '起業家',
      'ESTJ': '管理者',
      'INFP': '仲介者',
      'INFJ': '提唱者',
      'INTP': '論理学者',
      'INTJ': '建築家',
      'ISFP': '冒険家',
      'ISFJ': '擁護者',
      'ISTP': '職人',
      'ISTJ': '管理者'
    };

    // タイプの詳細説明
    const typeDescriptions = {
      'ENFP': '創造的で熱心なキャンペーナー。新しい可能性を探求し、人々とつながることを好みます。自由な発想と情熱で、周囲を巻き込む力があります。',
      'ENFJ': 'カリスマ的な教師タイプ。人々の成長を支援し、チームを導くことを得意とします。共感力が高く、他者の可能性を引き出すことができます。',
      'ENTP': '論理的で創造的な討論者。新しいアイデアを生み出し、議論を楽しみます。挑戦を好み、既存の枠組みに疑問を投げかけます。',
      'ENTJ': '戦略的な指揮官。目標達成のために組織を導くリーダーシップを持ちます。効率性と結果を重視し、長期的な視点で計画を立てます。',
      'ESFP': '自由で楽観的なエンターテイナー。現在を楽しみ、人々を楽しませることを好みます。柔軟性が高く、臨機応変に対応できます。',
      'ESFJ': '協調的な領事タイプ。伝統を大切にし、人々の調和を保つことを重視します。責任感が強く、他者をサポートすることが得意です。',
      'ESTP': '行動力のある起業家。リスクを取って、迅速に行動することを好みます。実践的で、現実的な問題解決が得意です。',
      'ESTJ': '実務的な管理者。効率性と組織性を重視し、ルールに従うことを好みます。信頼性が高く、責任感が強いです。',
      'INFP': '理想主義的な仲介者。価値観を大切にし、創造的な表現を好みます。内面的な世界が豊かで、深い共感力を持ちます。',
      'INFJ': '洞察力のある提唱者。深い理解力と共感力を持ち、人々を支援します。未来へのビジョンを持ち、他者の成長を支援します。',
      'INTP': '論理的な論理学者。理論を探求し、複雑な問題を解決することを好みます。客観的な分析が得意で、知識を追求します。',
      'INTJ': '戦略的な建築家。長期的な視点で計画を立て、効率的に実行します。独立性が高く、自分のビジョンを実現する力があります。',
      'ISFP': '柔軟で芸術的な冒険家。美しいものを好み、現在を大切にします。創造性が高く、個人的な価値観を重視します。',
      'ISFJ': '献身的な擁護者。責任感が強く、人々を守ることを重視します。細部への注意力が高く、他者をサポートすることが得意です。',
      'ISTP': '実用的な職人。技術的な問題を解決し、実践的なスキルを好みます。論理的で、効率的な解決策を見つけることが得意です。',
      'ISTJ': '責任感のある管理者。信頼性が高く、伝統と秩序を重視します。計画性が高く、着実に目標を達成します。'
    };

    // タイプの強み
    const typeStrengths = {
      'ENFP': '創造性、熱意、コミュニケーション能力、柔軟性、人々とのつながり',
      'ENFJ': 'リーダーシップ、共感力、他者の成長支援、チームワーク、ビジョン',
      'ENTP': '創造的思考、論理的思考、議論力、適応性、イノベーション',
      'ENTJ': '戦略的思考、リーダーシップ、効率性、決断力、目標達成',
      'ESFP': '楽観性、柔軟性、社交性、実践性、現在を楽しむ力',
      'ESFJ': '協調性、責任感、他者への配慮、組織力、伝統の尊重',
      'ESTP': '行動力、実践性、適応性、リスクテイク、問題解決',
      'ESTJ': '組織力、責任感、効率性、信頼性、実務能力',
      'INFP': '創造性、価値観の重視、共感力、柔軟性、内面的な深さ',
      'INFJ': '洞察力、共感力、ビジョン、他者の成長支援、深い理解',
      'INTP': '論理的思考、分析力、知識の追求、独立性、客観性',
      'INTJ': '戦略的思考、独立性、効率性、長期的視点、ビジョン実現',
      'ISFP': '創造性、柔軟性、美的感覚、個人的価値観、現在を大切にする',
      'ISFJ': '責任感、他者への配慮、細部への注意力、信頼性、献身性',
      'ISTP': '実践性、論理的思考、問題解決、独立性、技術的スキル',
      'ISTJ': '責任感、信頼性、計画性、組織力、伝統の尊重'
    };

    // 成長のヒント
    const typeGrowthTips = {
      'ENFP': '長期的な目標設定と計画性を意識し、細部への注意力を高めましょう。感情的な判断を避け、論理的な分析も取り入れると良いでしょう。',
      'ENFJ': '自分のニーズも大切にし、完璧主義を避けましょう。時には一人の時間を取って、自分自身をケアすることも重要です。',
      'ENTP': '感情的な側面も考慮し、他者の気持ちに配慮しましょう。計画性を高め、長期的な視点を持つと良いでしょう。',
      'ENTJ': '感情的な側面も大切にし、他者への共感力を高めましょう。柔軟性を持ち、時には計画を変更することも必要です。',
      'ESFP': '長期的な計画を立て、目標設定を意識しましょう。感情的な判断を避け、論理的な分析も取り入れると良いでしょう。',
      'ESFJ': '自分のニーズも大切にし、完璧主義を避けましょう。変化への適応力を高め、柔軟性を持つと良いでしょう。',
      'ESTP': '長期的な視点を持ち、計画性を高めましょう。感情的な側面も考慮し、他者の気持ちに配慮することが重要です。',
      'ESTJ': '感情的な側面も大切にし、柔軟性を持ちましょう。変化への適応力を高め、新しいアイデアを受け入れると良いでしょう。',
      'INFP': '実践的な行動を意識し、計画性を高めましょう。感情的な判断を避け、論理的な分析も取り入れると良いでしょう。',
      'INFJ': '実践的な行動を意識し、完璧主義を避けましょう。自分のニーズも大切にし、時には一人の時間を取ることも重要です。',
      'INTP': '感情的な側面も大切にし、他者への共感力を高めましょう。実践的な行動を意識し、計画性を高めると良いでしょう。',
      'INTJ': '感情的な側面も大切にし、他者への共感力を高めましょう。柔軟性を持ち、時には計画を変更することも必要です。',
      'ISFP': '長期的な計画を立て、目標設定を意識しましょう。感情的な判断を避け、論理的な分析も取り入れると良いでしょう。',
      'ISFJ': '自分のニーズも大切にし、完璧主義を避けましょう。変化への適応力を高め、柔軟性を持つと良いでしょう。',
      'ISTP': '感情的な側面も考慮し、他者の気持ちに配慮しましょう。長期的な視点を持ち、計画性を高めると良いでしょう。',
      'ISTJ': '感情的な側面も大切にし、柔軟性を持ちましょう。変化への適応力を高め、新しいアイデアを受け入れると良いでしょう。'
    };

    return {
      type: type,
      typeName: typeNames[type] || type,
      typeDescription: typeDescriptions[type] || 'このタイプの詳細な特徴については、アプリで詳しく確認できます。',
      strengths: typeStrengths[type] || 'このタイプの強みについては、アプリで詳しく確認できます。',
      growthTips: typeGrowthTips[type] || 'このタイプの成長のヒントについては、アプリで詳しく確認できます。',
      scores: scores,
      trademark: 'MBTI®はMyers-Briggs Type Indicator®の商標です。本サービスはMBTI®の公式サービスではありません。'
    };
  }
}

