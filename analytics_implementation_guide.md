# ユーザー動向把握の実装ガイド

## 📊 推奨される分析ツール

### 1. Google Analytics 4 (GA4) - 推奨

**メリット**:
- 無料で利用可能
- 詳細な分析が可能
- リアルタイムデータ
- カスタムイベントトラッキング
- プライバシー対応（GDPR対応）

**実装方法**:
1. Google Analyticsアカウントを作成
2. GA4プロパティを作成
3. 測定ID（G-XXXXXXXXXX）を取得
4. 全ページにトラッキングコードを追加

**必要なデータ**:
- ページビュー
- セッション時間
- 離脱率
- 診断完了率
- 診断結果の分布
- アプリ誘導のクリック率

### 2. Google Tag Manager (GTM) - 上級者向け

**メリット**:
- コード変更なしでタグ管理
- 複数の分析ツールを一元管理
- 柔軟なイベント設定

**実装方法**:
1. GTMアカウントを作成
2. コンテナIDを取得
3. GTMコードを全ページに追加
4. GA4タグをGTMで設定

### 3. プライバシー重視の分析ツール

**Plausible Analytics**:
- プライバシー重視
- GDPR準拠
- 軽量
- 有料（月額$9〜）

**Simple Analytics**:
- プライバシー重視
- クッキーなし
- 有料（月額$19〜）

---

## 🎯 測定すべき主要指標

### 基本指標
1. **ページビュー数**: 各ページのアクセス数
2. **セッション数**: 訪問回数
3. **セッション時間**: 滞在時間
4. **離脱率**: ページを離れる割合
5. **直帰率**: 1ページだけ見て離れる割合

### 診断関連指標
1. **診断開始率**: ランディングページから診断を開始した割合
2. **診断完了率**: 診断を最後まで完了した割合
3. **質問回答率**: 各質問の回答率
4. **診断結果の分布**: 各タイプの診断結果の分布
5. **診断再実行率**: 再度診断を行う割合

### コンバージョン指標
1. **アプリ誘導クリック率**: アプリダウンロードリンクのクリック率
2. **App Store遷移率**: App Storeへの遷移率
3. **Google Play遷移率**: Google Playへの遷移率
4. **問い合わせ送信率**: 問い合わせフォームの送信率

### ユーザー行動指標
1. **デバイス別アクセス**: PC、スマートフォン、タブレット
2. **ブラウザ別アクセス**: Chrome、Safari、Firefoxなど
3. **地域別アクセス**: 国・地域別のアクセス
4. **流入元**: 検索、直接、SNS、その他

---

## 💻 実装方法

### Google Analytics 4 (GA4) の実装

#### ステップ1: GA4アカウントの作成
1. [Google Analytics](https://analytics.google.com/)にアクセス
2. アカウントを作成
3. GA4プロパティを作成
4. 測定ID（G-XXXXXXXXXX）を取得

#### ステップ2: トラッキングコードの追加

**共通テンプレートファイルの作成**（推奨）:
- `_includes/analytics.html` を作成
- 全ページでインクルード

**または、各ページに直接追加**:
- `index.html`
- `test.html`
- その他のページ

#### ステップ3: カスタムイベントの実装

診断関連のイベント:
- `test_started`: 診断開始
- `question_answered`: 質問回答
- `test_completed`: 診断完了
- `result_viewed`: 結果表示
- `app_link_clicked`: アプリリンククリック

---

## 📝 実装例

### GA4の基本実装

```html
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');
</script>
```

### カスタムイベントの実装例

```javascript
// 診断開始
gtag('event', 'test_started', {
  'event_category': '診断',
  'event_label': '性格診断'
});

// 診断完了
gtag('event', 'test_completed', {
  'event_category': '診断',
  'event_label': '性格診断',
  'value': 1
});

// 診断結果表示
gtag('event', 'result_viewed', {
  'event_category': '診断',
  'event_label': 'Profilecode診断',
  'result_type': 'creative_innovator'
});

// アプリリンククリック
gtag('event', 'app_link_clicked', {
  'event_category': 'コンバージョン',
  'event_label': 'App Store',
  'value': 1
});
```

---

## 🔒 プライバシー対応

### GDPR対応
- クッキー同意バナーの実装
- プライバシーポリシーの更新
- データ保持期間の設定

### クッキー同意バナーの実装例

```html
<div id="cookie-consent" style="display: none;">
  <p>このサイトでは、ユーザー体験向上のため、クッキーを使用しています。</p>
  <button onclick="acceptCookies()">同意する</button>
  <button onclick="rejectCookies()">拒否する</button>
</div>
```

---

## 📈 分析ダッシュボードの設定

### GA4で設定すべきレポート

1. **リアルタイムレポート**: 現在のアクセス状況
2. **エンゲージメントレポート**: セッション時間、ページビュー
3. **コンバージョンレポート**: 診断完了率、アプリ誘導率
4. **カスタムレポート**: 診断結果の分布、質問回答率

### カスタムディメンションの設定

1. **診断タイプ**: Profilecode診断、MBTI
2. **診断結果**: 各タイプ名
3. **質問番号**: どの質問まで回答したか
4. **デバイスタイプ**: PC、スマートフォン、タブレット

---

## 🎯 実装優先順位

### フェーズ1: 基本実装（最優先）
1. **GA4の基本実装**
   - 全ページにトラッキングコードを追加
   - ページビュー、セッションの測定

2. **診断関連イベント**
   - 診断開始イベント
   - 診断完了イベント
   - 結果表示イベント

### フェーズ2: 詳細分析
3. **カスタムイベントの拡充**
   - 質問回答イベント
   - アプリ誘導クリックイベント
   - 診断結果の分布

4. **カスタムディメンションの設定**
   - 診断タイプ
   - 診断結果
   - デバイスタイプ

### フェーズ3: プライバシー対応
5. **クッキー同意バナーの実装**
6. **プライバシーポリシーの更新**

---

## ✅ 実装チェックリスト

### 基本実装
- [ ] Google Analyticsアカウントの作成
- [ ] GA4プロパティの作成
- [ ] 測定IDの取得
- [ ] 全ページにトラッキングコードを追加
- [ ] ページビューの測定確認

### 診断関連イベント
- [ ] 診断開始イベントの実装
- [ ] 診断完了イベントの実装
- [ ] 結果表示イベントの実装
- [ ] アプリ誘導クリックイベントの実装

### プライバシー対応
- [ ] クッキー同意バナーの実装
- [ ] プライバシーポリシーの更新
- [ ] GDPR対応の確認

---

## 📊 分析すべき主要指標

### 診断サービスのKPI

1. **診断完了率**: 診断を開始した人のうち、完了した人の割合
   - 目標: 70%以上

2. **アプリ誘導率**: 診断結果を見た人のうち、アプリリンクをクリックした人の割合
   - 目標: 30%以上

3. **再診断率**: 一度診断した人が再度診断する割合
   - 目標: 20%以上

4. **平均セッション時間**: ユーザーがサイトに滞在する平均時間
   - 目標: 5分以上

---

**作成日**: 2024年
**最終更新**: 2024年
**作成者**: profilecode開発チーム

